<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xml:base="http://127.0.0.1:8080/blog"  xmlns:dc="http://purl.org/dc/elements/1.1/">
<channel>
 <title>Everything is a Freaking DNS problem - recovery</title>
 <link>http://127.0.0.1:8080/blog/taxonomy/term/1130/0</link>
 <description></description>
 <language>en</language>
<item>
 <title>MythTV recover Lost+Found </title>
 <link>http://127.0.0.1:8080/blog/mythtv-recover-lostfound</link>
 <description>&lt;p&gt;My MythTV store lives on an LVM volume that is spread over 2 disks, one of them is an external USB disk.   So the cleaninglady seems to have touched a cable and after coming back from holiday I had a read-only filesystem that afer a remount had about 350Gb in lost+found   with irrelevant filenames.&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;geshifilter&quot;&gt;&lt;pre class=&quot;text geshifilter-text&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;ol&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;total 337407844&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;drwx------   2 tv   tv         4096 Dec 17 22:47 .&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;drwxrwxrwx  15 tv   tv         4096 Dec 17 22:44 ..&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root  423343556 Dec 14 07:10 I303109.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root 2990538924 Dec 13 19:05 I303107.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root 1023691768 Dec 13 08:10 I319494.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root 1023622348 Dec 13 07:45 I327684.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root  423735892 Dec 13 07:10 I327682.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root  466749476 Dec 12 15:43 I135169.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root 1023314212 Dec 12 07:45 I098309.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root 1022459928 Dec 12 06:35 I098306.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root 2458822948 Dec  9 22:50 I139264.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root 2129683736 Dec  9 21:30 I323592.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root  466735992 Dec  9 15:43 I323590.RCN&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;-rw-r--r--   1 root root 1022747296 Dec  9 07:45 I323588.RCN&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Obviously I wanted to recover my data.&lt;br /&gt;
So I had files with a wrong filename on a filesystem but with a correct timestamp and probably the right filesize.&lt;br /&gt;
Luckily the  mythconverg.recorded table also gives  me lots of information about the files that mythtv had originally stored the content in.&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;geshifilter&quot;&gt;&lt;pre class=&quot;text geshifilter-text&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;ol&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;mysql&amp;gt; select basename,lastmodified,filesize from recorded limit 10;&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;+---------------------------+---------------------+------------+&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| basename                  | lastmodified        | filesize   |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;+---------------------------+---------------------+------------+&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1003_20081003230000.mpg   | 2008-10-07 21:53:49 | 6197765380 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1093_20080320232600.mpg   | 2008-03-20 23:25:31 |          0 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1075_20060301191300.mpg   | 2006-03-24 22:48:42 |          0 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1002_20080729160500.mpg   | 2008-07-29 19:20:30 | 3679223940 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 592251_20081217072000.mpg | 2008-12-17 07:20:02 |          0 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1002_20080911143500.mpg   | 2008-09-11 16:41:44 | 3486101572 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1002_20080923143500.mpg   | 2008-09-23 16:49:41 | 3679789684 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1033_20081110153500.mpg   | 2008-11-10 15:47:12 |  338877000 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1002_20080922144000.mpg   | 2008-09-22 16:47:38 | 3485505140 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;| 1002_20080721160500.mpg   | 2008-07-23 20:52:16 | 3679559444 |&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;+---------------------------+---------------------+------------+&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;10 rows in set (0.00 sec)&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;My first idea was to use  &lt;a href=&quot;http://code.google.com/p/mysql-filesystem-engine/&quot; rel=&quot;nofollow&quot;&gt;the mysql filesystem engine&lt;/a&gt; to query the filesytem and write me a simple query however I totally failed to build that engine :(&lt;br /&gt;
(Anyone else successfull here ? )&lt;/p&gt;
&lt;p&gt;So I created a temp table&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;geshifilter&quot;&gt;&lt;pre class=&quot;text geshifilter-text&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;ol&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;CREATE TABLE `temp2` (&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;  `size` bigint(20) default NULL,&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;  `oldname` varchar(255) default NULL,&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;  `lastmod` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP&lt;/div&gt;&lt;/li&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;) ENGINE=MyISAM DEFAULT CHARSET=latin1&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;And parsed the content of my lost+found directory into a set of insert statements&lt;br /&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;pre class=&quot;text geshifilter-text&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;ol&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;ls -l --time-style=long-iso | awk  -F&#039; &#039; &#039;{print &amp;quot;insert into temp2 values (&amp;quot;  $5 &amp;quot;,\&amp;quot;&amp;quot;  $8&amp;quot;\&amp;quot;,\&amp;quot;&amp;quot;$6&amp;quot; &amp;quot;$7&amp;quot;\&amp;quot;);&amp;quot;}&#039;&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;From there is a matter of grabbing the matching filenames&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;geshifilter&quot;&gt;&lt;pre class=&quot;text geshifilter-text&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;ol&gt;&lt;li style=&quot;font-family: monospace; font-weight: normal;&quot;&gt;&lt;div style=&quot;font-family: monospace; font-weight: normal; font-style: normal&quot;&gt;echo &amp;quot;select \&amp;quot;mv \&amp;quot; , oldname, basename from recorded, temp2 where temp2.size= recorded.filesize ;&amp;quot; | mysql mythconverg&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;
&lt;p&gt;And moving the actual files ... now all is back to normal ..&lt;/p&gt;
</description>
 <comments>http://127.0.0.1:8080/blog/mythtv-recover-lostfound#comments</comments>
 <category domain="http://127.0.0.1:8080/blog/category/crash">crash</category>
 <category domain="http://127.0.0.1:8080/blog/category/lostfound">lost+found</category>
 <category domain="http://127.0.0.1:8080/blog/taxonomy/term/458">mysql</category>
 <category domain="http://127.0.0.1:8080/blog/taxonomy/term/504">mythtv</category>
 <category domain="http://127.0.0.1:8080/blog/taxonomy/term/599">opensource</category>
 <category domain="http://127.0.0.1:8080/blog/category/recovery">recovery</category>
 <category domain="http://127.0.0.1:8080/blog/category/scripting">scripting</category>
 <pubDate>Fri, 19 Dec 2008 18:41:17 +0000</pubDate>
 <dc:creator>Kris Buytaert</dc:creator>
 <guid isPermaLink="false">843 at http://127.0.0.1:8080/blog</guid>
</item>
</channel>
</rss>
