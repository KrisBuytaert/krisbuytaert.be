<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">

<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Using Veewee | Everything is a Freaking DNS problem</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../misc/favicon/index.ico" type="image/x-icon" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/aggregator/aggregator/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/node/node/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/poll/poll/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/cck/theme/content-module/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/date/date/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/geshifilter/geshifilter/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../misc/farbtastic/farbtastic/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/calendar/calendar/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/cck/modules/fieldgroup/fieldgroup/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/default/themes/barlow/typography/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/default/themes/barlow/layout/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/default/themes/barlow/style/index-2.css?i" />
<link type="text/css" rel="stylesheet" media="print" href="../sites/default/themes/barlow/print/index-2.css?i" />
</head>

<body class="not-front not-logged-in page-node node-type-blog one-sidebar sidebar-left">
<div id="wrapper">

<div id="header" class="p1">

  <div id="branding">
      <div id="logo">
    <a href="../index/index.html" title="Everything is a Freaking DNS problem" rel="home">
    <img src="../files/me_small/index.jpg" alt="Everything is a Freaking DNS problem" id="logo-image" />
    </a></div>
        <h1><a href="../index/index.html" title="Home" rel="home">Everything is a Freaking DNS problem</a></h1>
        <div class="slogan">Devops Needs Sushi</div>
    </div>

  
  <div class="skip"><a href="#content" title="Skip to site content" accesskey="2">Skip to content</a></div>

  
  <div id="menu">
      </div>
</div>

<div id="content">

  <div id="sidebar-left" class="sidebar">
  <div class="block block-block" id="block-block-5">
  <div class="content"><p>This is the blog where <a href="http://www.krisbuytaert.be/bio.shtml">Kris Buytaert</a> points you to extremely interresting and totally irrelevant stuff that happens in Life , The Universe and Everything</p>
<p>Questions, want to contact me please read my <a href="../faq/index/index.html">FAQ</a> and  <a href="../social/index/index.html">Social Media Policy</a></p>
<p>You can hire me! I work as a consultant for <a href="http://www.inuits.eu/">Inuits.eu</a></p>
</div>
</div>

  </div>

<div id="main">
  <div id="breadcrumb"><div class="breadcrumb"><a href="../index/index.html">Home</a> &#8594; <a href="../blog/index.html">Blogs</a> &#8594; <a href="../blogs/kris-buytaert/index.html">Kris Buytaert&#039;s blog</a></div></div>
  <h2 id="title">Using Veewee</h2>
<div class="content">
<div id="node-1049" class="node  blog">
<div class="content"><p>With @dancarley and @patrickebois just discussing the origin of the name of Veewee  I figured I still had that piece of documentation I wrote up for myselve flying around ...  </p>
<p>So with no other reason than having my docs mirrored on the internet . </p>
<p><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;"><ol><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">gem install veewee</div></li></ol></pre></div></p>
<p><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;"><ol><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">veewee templates</div></li></ol></pre></div><br />
shows you what templates we have around ..</p>
<p><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;"><ol><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">$veewee init natty ubuntu-11.04-server-amd64</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Init a new box natty, starting from template ubuntu-11.04-server-amd64</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">The basebox 'natty' has been successfully created from the template ''ubuntu-11.04-server-amd64'</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">You can now edit the definition files stored in definitions/natty</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">or build the box with:</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">vagrant basebox build 'natty'</div></li></ol></pre></div></p>
<p>As noted this will generate the definition for your natty box,<br />
It will create a definition.rb file which describes your box.<br />
A preseed (or kickstart or similar file)  and a postinstall file</p>
<p>The next step is then to use vagrant to build this basebox<br />
<div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;"><ol><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">$ vagrant  basebox build natty</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">&nbsp;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Verifying the isofile ubuntu-11.04-server-amd64.iso is ok.</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Creating vm natty : 384M - 1 CPU - Ubuntu_64</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Creating new harddrive of size 10140</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">VBoxManage createhd --filename '/home/sdog/VirtualBox VMs/natty/natty.vdi' --size '10140' --format vdi &gt; /dev/null</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Attaching disk: /home/sdog/VirtualBox VMs/natty/natty.vdi</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Mounting cdrom: /home/sdog/iso/ubuntu-11.04-server-amd64.iso</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Waiting for the machine to boot</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">&nbsp;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Typing:[1]: &lt;Esc&gt;&lt;Esc&gt;&lt;Enter&gt;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Typing:[2]: /install/vmlinuz noapic preseed/url=http://192.168.10.101:7122/preseed.cfg</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Typing:[3]: debian-installer=en_US auto locale=en_US kbd-chooser/method=us</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Typing:[4]: hostname=natty</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Typing:[5]: fb=false debconf/frontend=noninteractive</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Typing:[6]: keyboard-configuration/layout=USA keyboard-configuration/variant=USA console-setup/ask_detect=false </div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Typing:[7]: initrd=/install/initrd.gz -- &lt;Enter&gt;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Done typing.</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">&nbsp;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Starting a webserver on port 7122</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Serving file /home/sdog/definitions/natty/preseed.cfg</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">&nbsp;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Waiting for ssh login with user vagrant to sshd on port =&gt; 7222 to work</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">.....................................................................................................................................................Transferring /tmp/vbox.version20110822-6766-1xcca1e-0 to .vbox_version</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">..</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">&nbsp;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">&nbsp;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Step [0] was successfully - saving state</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">&nbsp;</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Waiting for ssh login with user vagrant to sshd on port =&gt; 7222 to work</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">.Transferring /home/sdog/definitions/natty/postinstall.sh to postinstall.sh</div></li></ol></pre></div><br />
Plenty more output here !</p>
<p>Be very patient ..  you will see VirtualBox launch a VM and start installing it ..</p>
<p>The next steps are clear .. vagrant tells you what you can do next</p>
<p><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;"><ol><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Now you can:</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">- verify your box by running               : vagrant basebox validate natty</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">- export your vm to a .box file by running : vagrant basebox export   natty</div></li></ol></pre></div></p>
<p>So after validating it , you can now export the basebox and share it with other people.</p>
<p>The next step is to actually use that box in your own Vagrant setup, for that you need to import the box into your box collection</p>
<p><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;"><ol><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">$ vagrant box add 'natty' 'natty.box'</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">[vagrant] Downloading with Vagrant::Downloaders::File...</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">[vagrant] Copying box to temporary location...</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">[vagrant] Extracting box...</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">[vagrant] Verifying box...</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">[vagrant] Cleaning up downloaded box...</div></li></ol></pre></div></p>
<p>To verify just run</p>
<p><div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;"><ol><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">$ vagrant box list</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">Centos6</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">MyCentOS2</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">debian</div></li><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">natty</div></li></ol></pre></div></p>
<p>your freslhy imported box should be in the list .</p>
<p>You can now use<br />
<div class="geshifilter"><pre class="text geshifilter-text" style="font-family:monospace;"><ol><li style="font-family: monospace; font-weight: normal;"><div style="font-family: monospace; font-weight: normal; font-style: normal">config.vm.box = &quot;natty&quot;</div></li></ol></pre></div> to refer to the fresly imported box in your Vagrant file, a file that can be created by running vagrant init, or copying around another Vagrant template ..</p>
<p>After that .. regular vagrant fun starts,  up,  provision, provision, provision, destroy,  and so forth ..</p>
</div>
  <div class="meta">
   <div class="submitted">Submitted by Kris Buytaert on Wed, 08/24/2011 - 10:41</div>
     <div class="taxonomy">Tags: <ul class="links inline"><li class="taxonomy_term_1328 first"><a href="../category/devops/index.html" rel="tag" title="">devops</a></li>
<li class="taxonomy_term_439"><a href="../taxonomy/term/439/index.html" rel="tag" title="">puppet</a></li>
<li class="taxonomy_term_1439"><a href="../category/vagrant/index.html" rel="tag" title="">vagrant</a></li>
<li class="taxonomy_term_1464 last"><a href="../category/veewee/index.html" rel="tag" title="">veewee</a></li>
</ul></div>
     <div class="links">&raquo; <ul class="links inline"><li class="blog_usernames_blog first last"><a href="../blogs/kris-buytaert/index.html" title="Read Kris Buytaert&#039;s latest blog entries.">Kris Buytaert&#039;s blog</a></li>
</ul></div>
  </div>
</div>
<div id="comments">
  <h2>Comments</h2>
  <a id="comment-4457"></a>
<div id="comment-1" class="comment comment-by-anonymous clear-block">
  <div class="picture">
  <img src="http://www.gravatar.com/avatar/0c13ff885802ae69bd4011b5b7ad5fe0.jpg?d=http%3A%2F%2F127.0.0.1%3A8080%2Fblog%2Fsites%2Fall%2Fmodules%2Fgravatar%2Favatar.png&amp;s=85&amp;r=G" alt="Joe J&#039;s picture" title="Joe J&#039;s picture"  /></div>
<h3>
    <a class="id" href="#comment-4457">#1</a>
    <span class="author"><span class="anonymous" title="not verified">Joe J</span></span>  : <span class="title"><a href="index.html#comment-4457" class="active">Your blog</a></span>
  </h3>
  <div class="content"><p>Your blog is really informative.</p>
<p>But my favorite thing is your title: "Everything is a Freaking DNS problem"</p>
<p>Haha. As a network admin I can attest to that!</p>
</div>
        <br class="clear" />
    <div class="submitted">09/22/2011 - 23:54</div>
  </div>
<a id="comment-4453"></a>
<div id="comment-2" class="comment comment-by-anonymous clear-block">
  <div class="picture">
  <a href="http://reliablenetworks.co.uk/" title="View user website." rel="external nofollow"><img src="http://www.gravatar.com/avatar/67f9f1763550af3b6b9b898c0c57e139.jpg?d=http%3A%2F%2F127.0.0.1%3A8080%2Fblog%2Fsites%2Fall%2Fmodules%2Fgravatar%2Favatar.png&amp;s=85&amp;r=G" alt="Kevin Cheney&#039;s picture" title="Kevin Cheney&#039;s picture"  /></a></div>
<h3>
    <a class="id" href="#comment-4453">#2</a>
    <span class="author"><a href="http://reliablenetworks.co.uk/">Kevin Cheney</a></span>  : <span class="title"><a href="index.html#comment-4453" class="active">I tried to build myself a</a></span>
  </h3>
  <div class="content"><p>I tried to build myself a basebox using veewee. But I hadn't much luck with it. I always got we tried to create a box or a box was here before but now it's gone. I don't know ruby but I checked with the scripts and everything basically seemed right. But I figured out that the system calls are not executed. After hours of trying I remembered to have read something about replacing execute() calls by execute2() calls. I changed all occurrences in the<br />
/opt/local/lib/ruby/gems/1.8/gems/veewee-0.1.29/lib/veewee/session.rb<br />
from Veewee.Shell.execute()<br />
to<br />
Veewee.Shell.execute2()<br />
and after that I could build a box. Well, I'm close. I still get an error while exporting the machine with<br />
vagrant basebox export 'deb1' I get<br />
...<br />
Excuting vagrant voodoo:<br />
vagrant package --base 'deb1' --output 'deb1.box'<br />
To import it into vagrant type:<br />
vagrant box add 'deb1' 'deb1.box'<br />
To use it:<br />
vagrant init 'deb1'<br />
vagrant up<br />
vagrant ssh<br />
/opt/local/lib/ruby/gems/1.8/gems/virtualbox-0.8.6/lib/virtualbox/com/imple menter/ffi.rb:95:in `call_and_check': Error in API call to add_redirect: 2147942487 (VirtualBox::Exceptions::FFIException)</p>
</div>
        <br class="clear" />
    <div class="submitted">09/20/2011 - 11:56</div>
  </div>
<a id="comment-4419"></a>
<div id="comment-3" class="comment comment-by-anonymous clear-block">
  <div class="picture">
  <a href="http://n00.be/" title="View user website." rel="external nofollow"><img src="http://www.gravatar.com/avatar/f6e4de2a79bca85c97c3e52b4ba3f54e.jpg?d=http%3A%2F%2F127.0.0.1%3A8080%2Fblog%2Fsites%2Fall%2Fmodules%2Fgravatar%2Favatar.png&amp;s=85&amp;r=G" alt="Thomas&#039;s picture" title="Thomas&#039;s picture"  /></a></div>
<h3>
    <a class="id" href="#comment-4419">#3</a>
    <span class="author"><a href="http://n00.be/">Thomas</a></span>  : <span class="title"><a href="index.html#comment-4419" class="active">Nice writeup!
You can also</a></span>
  </h3>
  <div class="content"><p>Nice writeup!</p>
<p>You can also use the 'basebox' task with vagrant once veewee is installed.</p>
<p>So instead of 'veewee templates' you can use 'vagrant basebox templates'. In the same way you can replace 'veewee init natty ubuntu-11.04-server-amd64' with 'vagrant basebox define natty ubuntu-11.04-server-amd64'</p>
<p>I also noticed with the Veewee version I'm using (0.2.0) that the vagrant.pub file isn't installed correctly. I had to edit the postinstall.sh definition and replace the URL for vagrant.pub with <a href="https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub" title="https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub" rel="nofollow">https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub</a></p>
<p>For some odd reason the redirect on the original URL didn't work and an nginx redirect error was echo'd into the authorized_keys file (instead of the actual public key).</p>
</div>
        <br class="clear" />
    <div class="submitted">08/24/2011 - 13:05</div>
  </div>
</div>
</div>
</div>

</div>

<div id="footer" class="footer">
  No really .. everything is a funky DNS problem , you'll realise I`m right pretty soon !   
  <p class="credits">Powered by <a href="http://www.drupal.org/">Drupal</a> and the <a href="http://www.drupal.org/project/barlow">Barlow</a> theme by <a href="http://egonbianchet.net/">Egon Bianchet</a>.</p>
</div>

</div>

</body>
</html>
